{% extends "dashboard/dashboard_base.html" %}
{% load i18n %}
{% load static %}
{% load widget_tweaks %}

{% block extra_head %}
    {{ form.media.css }}
{% endblock extra_head %}

{% block content_dashboard %}
    <div class="row">
        <div class="col-12 grid-margin stretch-card">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">{% trans "Input UNDSS" %}</h4>
                    <p class="card-description d-none">
                        Basic form elements
                    </p>
                    <form class="forms-sample form-undss" method="POST" enctype="multipart/form-data" >
                        {% csrf_token %}
                        {% comment %} {% include 'dashboard/form_format.html' with form=form %} {% endcomment %}


{% comment %} form {% endcomment %}
    {{ form.as_p }}
{% comment %} endform {% endcomment %}

                        <button type="submit" class="btn btn-primary mr-2">{% trans "Submit" %}</button>
                        <button class="btn btn-light">{% trans "Cancel" %}</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock content_dashboard %}

{% block dashboard_script %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js"></script>
    <script src="{% static 'js/file-upload.js' %}"></script>
    {{ form.media.js }}


    <script>
    $(document).ready(function(){
        $('select[name=Province]').change(function(){
            province_id = $(this).val();
            request_url = '/get_district/' + province_id + '/';
            $.ajax({
                url: request_url,
                success: function(data){
                    $('select[name="District"]').empty().djangoSelect2({
                        data: data
                    });
                }
            });
            return false;
        })

        $('select[name=Incident_Type]').change(function(){
            incidenttype_id = $(this).val();
            request_url = '/get_incident_subtype/' + incidenttype_id + '/';
            $.ajax({
                url: request_url,
                success: function(data){
                    $('select[name="Incident_Subtype"]').empty().djangoSelect2({
                        data: data
                    });
                }
            });
            return false;
        })


        $('select[name=District]').change(function(){
            district_id = $(this).val();
            province_id = $('select[name=Province]').children('option:selected').val()
            request_url_area = '/get_area_city/' + province_id + '/' + district_id + '/';
            $.ajax({
                url: request_url_area,
                success: function(data){
                    $('select[name="Area"]').empty().djangoSelect2({
                        data: data[0]['area']
                    });

                    $('select[name="City_Village"]').empty().djangoSelect2({
                        data: data[0]['cityvillage']
                    });
                }
            });
            return false;
        })
    });
    </script>
{% endblock dashboard_script %}